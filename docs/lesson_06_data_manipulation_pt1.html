<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data manipulation in R</title>

<script src="site_libs/header-attrs-2.26/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="Agenda.html">Agenda</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Before you come
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Before you come</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Lessons
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_000_R_Rstudio_project.html">Project Management, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_001_basic_ds_inR.html">Getting started with R</a>
    </li>
    <li>
      <a href="lesson_002_spreadsheets.html">Spreadsheets</a>
    </li>
    <li>
      <a href="lesson_003_working_with_spreadsheet.html">Working with Spreadsheets</a>
    </li>
    <li>
      <a href="lesson_06_data_manipulation_pt1.html">Data Manipulation</a>
    </li>
    <li>
      <a href="lesson_09_data_viz_pt1.html">Data Visualization</a>
    </li>
    <li>
      <a href="lesson_006_statistical_analyses.html">Statistical Analyses</a>
    </li>
  </ul>
</li>
<li>
  <a href="participants.html">Program Participants</a>
</li>
<li>
  <a href="slack.html">Join Slack Workspace</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://www.garrettlab.com">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Data manipulation in R</h1>

</div>


<div id="learning-objectives" class="section level3 blue">
<h3>Learning Objectives</h3>
<ul>
<li>Explain the purpose of the <em><code>dplyr</code></em> and
<em><code>tidyr</code></em> packages.</li>
<li>Use the <em><code>select</code></em> function from dplyr to pick
specific columns from a data frame.</li>
<li>Utilize the <em>filter</em> function from dplyr to choose specific
rows based on filtering conditions.</li>
<li>Employ the pipe operator <code>%&gt;%</code> to seamlessly connect
the output of one dplyr function to another.</li>
<li>Expand data frames by creating new columns derived from existing
ones using <strong><code>mutate</code></strong>.</li>
<li>Leverage <code>summarize</code>, <code>group_by</code>, and
<code>count</code> to break down a data frame into subsets, compute
summary statistics for each subset, and then merge the results.</li>
</ul>
</div>
<div id="data-manipulation-using-tidyverse" class="section level2">
<h2>Data Manipulation using <strong><code>tidyverse</code></strong></h2>
<p>Bracket subsetting, while useful, can become cumbersome and
challenging to interpret, especially for complex operations.</p>
<p><strong><code>dplyr</code></strong>. It’s a package designed to
simplify tabular data manipulation tasks, providing a more intuitive
approach. <strong><code>dplyr</code></strong> pairs seamlessly with
<strong><code>tidyr</code></strong>, which facilitates swift conversion
between various data formats, aiding in visualization and analysis.</p>
<p>In R, packages extend the functionality of the base language by
providing additional functions for various tasks. While R comes with
built-in functions like <code>str()</code> and
<code>data.frame()</code>, packages offer a broader range of tools. To
use a package, you typically need to install it on your system initially
and then import it into your R session whenever needed. The
<strong><code>tidyverse</code></strong> package, which you should
already have installed, is particularly valuable. It serves as an
“umbrella-package,” bundling together several essential packages for
data analysis, including <strong><code>tidyr</code></strong>,
<strong><code>dplyr</code></strong>,
<strong><code>ggplot2</code></strong>, and
<strong><code>tibble</code></strong>, among others, ensuring they work
harmoniously together.</p>
<p>To install the package type:</p>
<pre class="r"><code># install.packages(&quot;tidyverse&quot;)
# install.packages(&quot;ggpubr&quot;)</code></pre>
<p>To load the package type:</p>
<pre class="r"><code>library(&quot;tidyverse&quot;)    ## load the tidyverse packages, incl. dplyr</code></pre>
<p>We’ll read in our data using the <code>read.csv()</code> function.
You should have already downloaded and organized data from the github
repo.</p>
<pre class="r"><code>yield_df &lt;- read.csv(&quot;input_data/tomato_grafting_yield_spad.csv&quot;, header = TRUE)

## inspect the data
str(yield_df)


# head of the data
head(yield_df)</code></pre>
<p>Notice that the class of the data is now <code>tbl_df</code> This is
referred to as a “tibble”. Tibbles are almost identical to R’s standard
data frames, but they tweak some of the old behaviors of data frames.
For our purposes the only differences between data frames and tibbles
are that:</p>
<ol style="list-style-type: decimal">
<li>When you print a tibble, R displays the data type of each column
|&gt; under its name; it prints only the first few rows of data and only
as many columns as fit on one screen.</li>
<li>Columns of class <code>character</code> are never automatically
converted into factors.</li>
</ol>
</div>
<div id="selecting-columns-and-filtering-rows" class="section level2">
<h2>Selecting columns and filtering rows</h2>
<p>We’re going to learn some of the most common
<strong><code>dplyr</code></strong> functions: <code>select()</code>,
<code>filter()</code>, <code>mutate()</code>, <code>group_by()</code>,
<code>summarize()</code>, and <code>join</code>. To select columns of a
data frame, use <code>select()</code>. The first argument to this
function is the data frame (<code>yield_df</code>), and the subsequent
arguments are the <strong>columns</strong> to keep.</p>
<pre class="r"><code>head(select(yield_df, plantID, sampling_date))</code></pre>
<p>We can also use pipe function to make it more clear. Pipes let you
take the output of one function and send it directly to the next, which
is useful when you need to do many things to the same dataset. Pipes in
R look like <code>%&gt;%</code> and are made available via the
<strong><code>magrittr</code></strong> package, installed automatically
with <strong><code>tidyverse</code></strong>.</p>
<pre class="r"><code>library(tidyverse)
yield_df %&gt;% select(plantID, sampling_date) %&gt;%
  head()</code></pre>
<pre><code>##      plantID sampling_date
## 1 T1-B1-M-P1       6/15/18
## 2 T1-B2-M-P1       6/15/18
## 3 T1-B3-M-P1       6/15/18
## 4 T1-B4-M-P1       6/15/18
## 5 T2-B1-M-P1       6/15/18
## 6 T2-B2-M-P1       6/15/18</code></pre>
<p>To choose <strong>rows</strong> based on a specific criteria, use
<code>filter()</code>:</p>
<pre class="r"><code>yield_df %&gt;% filter(sampling_date==&quot;6/15/18&quot;) %&gt;%
  head()</code></pre>
<pre><code>##      plantID marketable_yield_kg spad_value sampling_date
## 1 T1-B1-M-P1                49.9       77.3       6/15/18
## 2 T1-B2-M-P1                47.7       79.2       6/15/18
## 3 T1-B3-M-P1                52.5       72.4       6/15/18
## 4 T1-B4-M-P1                52.5       78.5       6/15/18
## 5 T2-B1-M-P1                53.1       81.4       6/15/18
## 6 T2-B2-M-P1                53.8       79.5       6/15/18</code></pre>
<p><code>select</code> is used for <strong>rows</strong> and
<code>filter</code> is used for <strong>columns</strong>.</p>
<p>What if you want to select and filter at the same time? Let say we
want to select select plantID, sampling date, and filter marketable
yield greater than 50.</p>
<pre class="r"><code>yield_df %&gt;% 
  select(plantID, marketable_yield_kg, sampling_date) %&gt;%
  filter(marketable_yield_kg &gt; 50) %&gt;%
  head()</code></pre>
<pre><code>##      plantID marketable_yield_kg sampling_date
## 1 T1-B3-M-P1                52.5       6/15/18
## 2 T1-B4-M-P1                52.5       6/15/18
## 3 T2-B1-M-P1                53.1       6/15/18
## 4 T2-B2-M-P1                53.8       6/15/18
## 5 T3-B1-M-P1                50.8       6/15/18
## 6 T3-B2-M-P1                51.9       6/15/18</code></pre>
<p>In the above code, we use the pipe to send the <code>yield_df</code>
dataset first through <code>select()</code> to select the three columns
of interest, then we use <code>filter()</code> to filter out rows that
is greater tan 50. Since <code>%&gt;%</code> takes the object on its
left and passes it as the first argument to the function on its right,
we don’t need to explicitly include the data frame as an argument to the
<code>filter()</code> and <code>select()</code> functions any more.</p>
<p>Some may find it helpful to read the pipe like the word “then”. For
instance, in the above example, we took the data frame
<code>yield_df</code>, <em>then</em> we <code>filter</code>ed for rows
with <code>marketable_yield_kg &gt; 50</code>, <em>then</em> we
<code>select</code>ed columns <code>plantID</code>,
<code>marketable_yield_kg</code>, and <code>sampling_date</code>. The
<strong><code>dplyr</code></strong> functions by themselves are somewhat
simple, but by combining them into linear workflows with the pipe, we
can accomplish more complex manipulations of data frames.</p>
<p>If we want to create a new object with this smaller version of the
data, we can assign it a new name:</p>
<pre class="r"><code>yield_g_50 &lt;- yield_df %&gt;% 
  select(plantID, marketable_yield_kg, sampling_date) %&gt;%
  filter(marketable_yield_kg &gt; 50)


head(yield_g_50)</code></pre>
<pre><code>##      plantID marketable_yield_kg sampling_date
## 1 T1-B3-M-P1                52.5       6/15/18
## 2 T1-B4-M-P1                52.5       6/15/18
## 3 T2-B1-M-P1                53.1       6/15/18
## 4 T2-B2-M-P1                53.8       6/15/18
## 5 T3-B1-M-P1                50.8       6/15/18
## 6 T3-B2-M-P1                51.9       6/15/18</code></pre>
<p>Note that the final data frame is the leftmost part of this
expression.</p>
<div id="challenge" class="section level3 blue">
<h3>Challenge</h3>
<p>Can you selec the samples with marketable_yield greater than 50 for
the sampled collected in june but not july?</p>
<details>
<summary>
ANSWER
</summary>
<pre class="r"><code>yield_g_50_june &lt;- yield_df %&gt;% 
  select(plantID, marketable_yield_kg, sampling_date) %&gt;%
  filter(marketable_yield_kg &gt; 50 &amp; sampling_date==&quot;6/15/18&quot;) %&gt;%
  head()

# what about negative selection


yield_g_50_m2 &lt;- yield_df %&gt;% 
  select(plantID, marketable_yield_kg, sampling_date) %&gt;%
  filter(marketable_yield_kg &gt; 50 &amp; sampling_date!=&quot;july-15-2018&quot;) %&gt;%
  head()</code></pre>
</details>
</div>
<p><br></p>
</div>
<div id="mutate" class="section level2">
<h2>Mutate</h2>
<p>Frequently you’ll want to create new columns based on the values in
existing columns, for example to do unit conversions, or to find the
ratio of values in two columns. For this we’ll use
<code>mutate()</code>.</p>
<p>To create a new column of weight in kg:</p>
<pre class="r"><code>yield_df %&gt;%
  mutate(marketable_yield_gram = marketable_yield_kg * 1000) %&gt;%
  head()</code></pre>
<pre><code>##      plantID marketable_yield_kg spad_value sampling_date marketable_yield_gram
## 1 T1-B1-M-P1                49.9       77.3       6/15/18                 49900
## 2 T1-B2-M-P1                47.7       79.2       6/15/18                 47700
## 3 T1-B3-M-P1                52.5       72.4       6/15/18                 52500
## 4 T1-B4-M-P1                52.5       78.5       6/15/18                 52500
## 5 T2-B1-M-P1                53.1       81.4       6/15/18                 53100
## 6 T2-B2-M-P1                53.8       79.5       6/15/18                 53800</code></pre>
<p>You can also create a second new column based on the first new column
within the same call of <code>mutate()</code>:</p>
<pre class="r"><code>yield_df %&gt;%
  mutate(marketable_yield_gram = marketable_yield_kg * 1000, 
         marketable_yield_lbs = marketable_yield_kg * 2.2) %&gt;%
  head()</code></pre>
<pre><code>##      plantID marketable_yield_kg spad_value sampling_date marketable_yield_gram
## 1 T1-B1-M-P1                49.9       77.3       6/15/18                 49900
## 2 T1-B2-M-P1                47.7       79.2       6/15/18                 47700
## 3 T1-B3-M-P1                52.5       72.4       6/15/18                 52500
## 4 T1-B4-M-P1                52.5       78.5       6/15/18                 52500
## 5 T2-B1-M-P1                53.1       81.4       6/15/18                 53100
## 6 T2-B2-M-P1                53.8       79.5       6/15/18                 53800
##   marketable_yield_lbs
## 1               109.78
## 2               104.94
## 3               115.50
## 4               115.50
## 5               116.82
## 6               118.36</code></pre>
<p>If this runs off your screen and you just want to see the first few
rows, you can use a pipe to view the <code>head()</code> of the data.
(Pipes work with non-<strong><code>dplyr</code></strong> functions, too,
as long as the <strong><code>dplyr</code></strong> or
<code>magrittr</code> package is loaded).</p>
<pre class="r"><code>yield_df %&gt;%
  mutate(marketable_yield_gram = marketable_yield_kg * 1000, 
         marketable_yield_lbs = marketable_yield_kg * 2.2) %&gt;%
  head()</code></pre>
<pre><code>##      plantID marketable_yield_kg spad_value sampling_date marketable_yield_gram
## 1 T1-B1-M-P1                49.9       77.3       6/15/18                 49900
## 2 T1-B2-M-P1                47.7       79.2       6/15/18                 47700
## 3 T1-B3-M-P1                52.5       72.4       6/15/18                 52500
## 4 T1-B4-M-P1                52.5       78.5       6/15/18                 52500
## 5 T2-B1-M-P1                53.1       81.4       6/15/18                 53100
## 6 T2-B2-M-P1                53.8       79.5       6/15/18                 53800
##   marketable_yield_lbs
## 1               109.78
## 2               104.94
## 3               115.50
## 4               115.50
## 5               116.82
## 6               118.36</code></pre>
<p>How to deal with NA in data? Although the example data set that we
are working here doesnot have NA. Lets modify the dataframe and work
with it. For now you can just run the following code.</p>
<pre class="r"><code>yield_wit_NA_df &lt;- yield_df %&gt;%
  mutate(raw_yield = ifelse(marketable_yield_kg &lt; 20, NA, marketable_yield_kg)) %&gt;%
  head()</code></pre>
<p>The first few rows of the output are full of <code>NA</code>s, so if
we wanted to remove those we could insert a <code>filter()</code> in the
chain:</p>
<pre class="r"><code>yield_wit_NA_df %&gt;%
  filter(!is.na(raw_yield)) %&gt;%
  mutate(marketable_yield_gram = marketable_yield_kg * 1000) %&gt;%
  head()</code></pre>
<pre><code>##      plantID marketable_yield_kg spad_value sampling_date raw_yield
## 1 T1-B1-M-P1                49.9       77.3       6/15/18      49.9
## 2 T1-B2-M-P1                47.7       79.2       6/15/18      47.7
## 3 T1-B3-M-P1                52.5       72.4       6/15/18      52.5
## 4 T1-B4-M-P1                52.5       78.5       6/15/18      52.5
## 5 T2-B1-M-P1                53.1       81.4       6/15/18      53.1
## 6 T2-B2-M-P1                53.8       79.5       6/15/18      53.8
##   marketable_yield_gram
## 1                 49900
## 2                 47700
## 3                 52500
## 4                 52500
## 5                 53100
## 6                 53800</code></pre>
<p><code>is.na()</code> is a function that determines whether something
is an <code>NA</code>. The <code>!</code> symbol negates the result, so
we’re asking for every row where weight <em>is not</em> an
<code>NA</code>.</p>
<div id="challenge-1" class="section level3 blue">
<h3>Challenge</h3>
<p>Create a new data frame from the <code>yield_wit_NA_df</code> data
that meets the following criteria: contains only the
<code>plantID</code>, <code>sampling_date</code> columns, and a new
column called <code>marketable_yield_lbs</code> containing values of
marketable yield in pound (lbs). Note: 1kg ~ 2.2lbs In this
<code>marketable_yield_lbs</code> column, there are no <code>NA</code>s
and all values are less than 100lbs and belong to july sampling. Name
this data frame <code>yield_july_lbs_df</code>.</p>
<p><strong>Hint</strong>: think about how the commands should be ordered
to produce this data frame!</p>
<details>
<summary>
ANSWER
</summary>
<pre class="r"><code>yield_july_lbs_df &lt;- yield_wit_NA_df %&gt;%
    filter(!is.na(raw_yield)) %&gt;%
    filter(sampling_date==&quot;july-15-2018&quot;) %&gt;%
    mutate(marketable_yield_lbs = marketable_yield_kg * 2.2) %&gt;%
    filter(marketable_yield_lbs &gt; 100 ) %&gt;%
    select(plantID, sampling_date, marketable_yield_lbs)</code></pre>
</details>
</div>
<p><br></p>
</div>
<div id="group-by-and-summarize" class="section level2">
<h2>Group by and summarize</h2>
<p>Many data analysis tasks can be approached using the
<em>split-apply-combine</em> paradigm: split the data into groups, apply
some analysis to each group, and then combine the results.
<strong><code>dplyr</code></strong> makes this very easy through the use
of the <code>group_by()</code> function.</p>
<p><code>group_by()</code> is often used together with
<code>summarize()</code>, which collapses each group into a single-row
summary of that group. <code>group_by()</code> takes as arguments the
column names that contain the <strong>categorical</strong> variables for
which you want to calculate the summary statistics. So to compute the
mean <code>weight</code> by sex:</p>
<pre class="r"><code>yield_df %&gt;%
  group_by(sampling_date) %&gt;%
  summarize(mean_weight = mean(marketable_yield_kg, na.rm = TRUE))</code></pre>
<pre><code>## # A tibble: 2 × 2
##   sampling_date mean_weight
##   &lt;chr&gt;               &lt;dbl&gt;
## 1 6/15/18              29.2
## 2 july-15-2018         29.4</code></pre>
<p>You may also have noticed that the output from these calls doesn’t
run off the screen anymore. It’s one of the advantages of
<code>tbl_df</code> over data frame.</p>
</div>
<div id="join" class="section level2">
<h2>Join</h2>
<p>Often we have multiple table to work with, and in dplyr we can
combine different related table using joins. Lets bring in our metadata
file, join with the yiled data. This will allow us to answer more
interesting meaningful question regarding tomato yield across various
rootstocks that we studied in this work.</p>
<pre class="r"><code>meta_df &lt;- read.csv(&quot;input_data/tomato_grafting_metadata.csv&quot;, header = TRUE)
str(meta_df)</code></pre>
<pre><code>## &#39;data.frame&#39;:    160 obs. of  2 variables:
##  $ plantID  : chr  &quot;T1-B1-M-P1&quot; &quot;T1-B2-M-P1&quot; &quot;T1-B3-M-P1&quot; &quot;T1-B4-M-P1&quot; ...
##  $ rootstock: chr  &quot;Maxifort&quot; &quot;Maxifort&quot; &quot;Maxifort&quot; &quot;Maxifort&quot; ...</code></pre>
<pre class="r"><code># merge metadata with yield data
yield_with_meata_df &lt;- merge(yield_df, meta_df, by=&quot;plantID&quot;)

head(yield_with_meata_df)</code></pre>
<pre><code>##      plantID marketable_yield_kg spad_value sampling_date  rootstock
## 1 T1-B1-M-P1                49.9       77.3       6/15/18   Maxifort
## 2 T1-B1-M-P2                52.9       80.6  july-15-2018   Maxifort
## 3 T1-B1-N-P1                33.4       53.2       6/15/18   Nongraft
## 4 T1-B1-N-P2                21.1       48.9  july-15-2018   Nongraft
## 5 T1-B1-R-P1                23.0       47.4       6/15/18 RST-04-106
## 6 T1-B1-R-P2                27.0       51.4  july-15-2018 RST-04-106</code></pre>
<p><img src="img/joinsinR.png" width="1000" /></p>
<p>You can also group by multiple columns:</p>
<pre class="r"><code>yield_with_meata_df %&gt;%
  group_by(rootstock, sampling_date) %&gt;%
  summarize(mean_weight = mean(marketable_yield_kg, na.rm = TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;rootstock&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 8 × 3
## # Groups:   rootstock [4]
##   rootstock  sampling_date mean_weight
##   &lt;chr&gt;      &lt;chr&gt;               &lt;dbl&gt;
## 1 Maxifort   6/15/18              49.7
## 2 Maxifort   july-15-2018         49.4
## 3 Nongraft   6/15/18              23.4
## 4 Nongraft   july-15-2018         21.9
## 5 RST-04-106 6/15/18              23.1
## 6 RST-04-106 july-15-2018         24.0
## 7 Selfgraft  6/15/18              20.5
## 8 Selfgraft  july-15-2018         22.1</code></pre>
<p>Here we are getting average marketable_yield_kg by rootstocks and two
sampling dates.</p>
<p>Once the data are grouped, you can also summarize multiple variables
at the same time (and not necessarily on the same variable). For
instance, we could add a column indicating the mean spad for each
rootstock:</p>
<pre class="r"><code>yield_with_meata_df %&gt;%
  group_by(rootstock) %&gt;%
  summarize(mean_weight = mean(marketable_yield_kg),
            mean_spad = mean(spad_value))</code></pre>
<pre><code>## # A tibble: 4 × 3
##   rootstock  mean_weight mean_spad
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;
## 1 Maxifort          49.5      80.1
## 2 Nongraft          22.6      52.6
## 3 RST-04-106        23.6      53.5
## 4 Selfgraft         21.3      51.5</code></pre>
<div id="challenge-2" class="section level3 blue">
<h3>Challenge</h3>
<ol style="list-style-type: decimal">
<li><p>Find maximum yiled by rootstocks in each sampling date Arrange
the table by smapling date by in descending date, i.e july first, then
june.</p></li>
<li><p>Try out a new function, <code>count()</code>. Group the data by
<code>rootstock</code> and pipe the grouped data into the
<code>count()</code> function. How could you get the same result using
<code>group_by()</code> and <code>summarize()</code>? Hint: see
<code>?n</code>.</p></li>
<li><p>Are the number of sample per rootstocks same for june and
july?</p></li>
</ol>
<details>
<summary>
ANSWER
</summary>
<pre class="r"><code>## Answer 1
yield_with_meata_df %&gt;%
  group_by(rootstock, sampling_date) %&gt;%
  summarize(max_yiled = max(marketable_yield_kg)) %&gt;%
  arrange(desc(sampling_date))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;rootstock&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 8 × 3
## # Groups:   rootstock [4]
##   rootstock  sampling_date max_yiled
##   &lt;chr&gt;      &lt;chr&gt;             &lt;dbl&gt;
## 1 Maxifort   july-15-2018       55.1
## 2 Nongraft   july-15-2018       29.2
## 3 RST-04-106 july-15-2018       27.7
## 4 Selfgraft  july-15-2018       28.7
## 5 Maxifort   6/15/18            54.4
## 6 Nongraft   6/15/18            33.4
## 7 RST-04-106 6/15/18            27.3
## 8 Selfgraft  6/15/18            27.5</code></pre>
<pre class="r"><code>## Answer 2
yield_with_meata_df %&gt;%
  group_by(rootstock) %&gt;%
  count()</code></pre>
<pre><code>## # A tibble: 4 × 2
## # Groups:   rootstock [4]
##   rootstock      n
##   &lt;chr&gt;      &lt;int&gt;
## 1 Maxifort      40
## 2 Nongraft      40
## 3 RST-04-106    40
## 4 Selfgraft     40</code></pre>
<pre class="r"><code>## Answer 3
yield_with_meata_df %&gt;%
  group_by(rootstock, sampling_date) %&gt;%
  count()</code></pre>
<pre><code>## # A tibble: 8 × 3
## # Groups:   rootstock, sampling_date [8]
##   rootstock  sampling_date     n
##   &lt;chr&gt;      &lt;chr&gt;         &lt;int&gt;
## 1 Maxifort   6/15/18          20
## 2 Maxifort   july-15-2018     20
## 3 Nongraft   6/15/18          20
## 4 Nongraft   july-15-2018     20
## 5 RST-04-106 6/15/18          20
## 6 RST-04-106 july-15-2018     20
## 7 Selfgraft  6/15/18          20
## 8 Selfgraft  july-15-2018     20</code></pre>
</details>
</div>
<p><br></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
